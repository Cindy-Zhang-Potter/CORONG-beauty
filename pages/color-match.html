<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½è‰²å·åŒ¹é… - CORONG è”»å®¹</title>
    <!-- å¼•å…¥Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- å¼•å…¥Bootstrapå›¾æ ‡ï¼ˆä¿®å¤å›¾æ ‡ä¸æ˜¾ç¤ºé—®é¢˜ï¼‰ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            padding-top: 80px;
            background-color: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .section-title {
            text-align: center;
            margin-bottom: 2.5rem;
            font-weight: bold;
            color: #333;
        }
        .color-block {
            width: 300px;
            height: 100px;
            border-radius: 8px;
            margin: 0 auto;
            border: 2px solid #ddd;
        }
        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 12px;
            padding: 3rem;
            text-align: center;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            border-color: #ff6b6b;
            background: #fff5f5;
        }
        .spinner-container {
            display: none;
            text-align: center;
            padding: 2rem 0;
        }
        .rgb-value {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 5px 10px;
            border-radius: 6px;
        }
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .btn-upload {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            border: none;
            color: white;
            padding: 10px 25px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-upload:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,107,107,0.3);
        }
        .result-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        /* æ–°å¢ï¼šé¢„è§ˆå›¾ç‰‡å®¹å™¨æ ·å¼ï¼Œä¿è¯ç­‰æ¯”ä¾‹ç¼©æ”¾ */
        .preview-img-container {
            max-width: 100%;
            max-height: 400px; /* é™åˆ¶æœ€å¤§é«˜åº¦ï¼Œä¸å‹å± */
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .preview-img-container img {
            width: auto;
            height: auto;
            max-width: 100%;
            max-height: 400px; /* å…³é”®ï¼šåŒæ—¶é™åˆ¶å®½é«˜ï¼Œç­‰æ¯”ä¾‹ç¼©æ”¾ */
            object-fit: contain; /* æ ¸å¿ƒï¼šä¿æŒå›¾ç‰‡æ¯”ä¾‹ï¼Œä¸æ‹‰ä¼¸ */
        }
                /* å¯¼èˆªæ æ ·å¼ï¼ˆå’Œç¾å¦†ç«™ä¸€è‡´ï¼‰ */
        header {
            background-color: white !important;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

    </style>
</head>
<body>
    <!-- å…¬å…±é¡µçœ‰ï¼ˆå’Œç¾å¦†ç«™å®Œå…¨ä¸€è‡´ï¼‰ -->
    <header class="navbar navbar-expand-lg fixed-top bg-white shadow-sm py-3">
        <div class="container">
            <a class="navbar-brand text-danger text-decoration-none" href="index.html">
                <span class="fw-bold fs-4 d-block">CORONG è”»å®¹</span>
                <span class="fs-7 text-dark opacity-70 d-block" style="font-size: 0.7rem !important;">ä¸œå—äºšç¾å¦†ç”µå•†å¹³å°</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="index.html">é¦–é¡µ</a></li>
                    <li class="nav-item"><a class="nav-link" href="products.html">äº§å“ç³»åˆ—</a></li>
                    <li class="nav-item"><a class="nav-link" href="reviews.html">çœŸå®æµ‹è¯„</a></li>
                    <li class="nav-item"><a class="nav-link text-danger fw-bold active" href="color-match.html">æ™ºèƒ½è‰²å·åŒ¹é…</a></li>
                </ul>
            </div>
        </div>
    </header>



    <main class="container py-5">
        <h1 class="section-title">ğŸ¨ æ™ºèƒ½è‰²å·åŒ¹é…å·¥å…·</h1>
        <p class="text-center text-muted mb-5">ä¸Šä¼ äººè„¸æ­£é¢ç…§ï¼Œè‡ªåŠ¨åŒ¹é…æœ€é€‚åˆçš„ç²‰åº•è‰²å·</p>

        <!-- å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
        <div class="row justify-content-center mb-5">
            <div class="col-md-8">
                <div class="upload-area" id="uploadArea">
                    <div class="mb-4">
                        <i class="bi bi-camera fs-1 text-danger" style="font-size: 3rem !important;"></i>
                    </div>
                    <h4 class="mb-3">ç‚¹å‡»ä¸Šä¼ äººè„¸ç…§ç‰‡</h4>
                    <p class="text-muted mb-4">æ”¯æŒ JPG/PNG æ ¼å¼ï¼Œå»ºè®®æ­£é¢æ¸…æ™°ç…§ç‰‡</p>
                    <button class="btn-upload" onclick="document.getElementById('imageUpload').click()">
                        é€‰æ‹©å›¾ç‰‡
                    </button>
                    <input type="file" class="form-control d-none" id="imageUpload" accept="image/*">
                    <p class="text-muted mt-3 small">æˆ–è€…ç›´æ¥å°†å›¾ç‰‡æ‹–æ‹½åˆ°æ­¤å¤„</p>
                </div>
                
                <!-- å›¾ç‰‡é¢„è§ˆï¼ˆå…³é”®ä¿®æ”¹ï¼šæ–°å¢å®¹å™¨ä¿è¯ç­‰æ¯”ä¾‹ï¼‰ -->
                <div id="imagePreview" class="text-center mt-4" style="display: none;">
                    <div class="card p-3">
                        <h6 class="mb-3">é¢„è§ˆå›¾ç‰‡</h6>
                        <!-- æ–°å¢å®¹å™¨ï¼šè§£å†³å›¾ç‰‡å‹æ‰é—®é¢˜ -->
                        <div class="preview-img-container mb-3">
                            <img id="previewImg" src="" alt="ä¸Šä¼ çš„å›¾ç‰‡" class="img-fluid rounded">
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-sm btn-outline-danger me-2" onclick="resetUpload()">é‡æ–°ä¸Šä¼ </button>
                            <button class="btn btn-sm btn-danger" onclick="analyzeImage()">å¼€å§‹åˆ†æ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åŠ è½½ä¸­ -->
        <div class="spinner-container" id="loadingSpinner">
            <div class="spinner-border text-danger" style="width: 3rem; height: 3rem;"></div>
            <p class="mt-3 fs-5">æ­£åœ¨åˆ†æè‚¤è‰²...</p>
            <div class="progress mt-3" style="height: 8px; width: 300px; margin: 0 auto;">
                <div class="progress-bar progress-bar-striped progress-bar-animated bg-danger" id="progressBar" style="width: 0%"></div>
            </div>
        </div>

        <!-- åˆ†æç»“æœ -->
        <div id="resultArea" class="mt-5" style="display: none;">
            <div class="alert alert-success">
                <i class="bi bi-check-circle me-2"></i>
                åˆ†æå®Œæˆï¼å·²æˆåŠŸåŒ¹é…æœ€é€‚åˆçš„è‰²å·
            </div>
            
            <div class="row justify-content-center mb-5">
                <div class="col-md-10">
                    <div class="card p-4">
                        <h3 class="text-center mb-4"><i class="bi bi-palette2 me-2"></i>æœ€ä½³åŒ¹é…ç»“æœ</h3>
                        
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="result-card">
                                    <h5><i class="bi bi-paint-bucket me-2"></i>æ¨èè‰²å·</h5>
                                    <p><strong>è‰²å·åç§°ï¼š</strong><br><span id="colorName" class="fs-4 text-danger"></span></p>
                                    <p><strong>è‰²å·ç¼–ç ï¼š</strong><br><span id="colorCode" class="fs-5"></span></p>
                                    <p><strong>RGBå€¼ï¼š</strong><br><span class="rgb-value" id="colorRgb"></span></p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="result-card">
                                    <h5><i class="bi bi-person-heart me-2"></i>æ£€æµ‹åˆ°çš„è‚¤è‰²</h5>
                                    <p><strong>å¹³å‡è‚¤è‰²ï¼š</strong><br><span class="rgb-value" id="skinRgb"></span></p>
                                    <p><strong>åŒ¹é…åº¦ï¼š</strong><br><span id="distance" class="fs-4 text-success"></span></p>
                                    <p class="text-muted small">ï¼ˆæ•°å€¼è¶Šå°åŒ¹é…åº¦è¶Šé«˜ï¼‰</p>
                                </div>
                            </div>
                        </div>

                        <!-- è‰²å—å±•ç¤º -->
                        <div class="text-center mb-4">
                            <h5 class="mb-3">æ¨èè‰²å·å±•ç¤º</h5>
                            <div id="colorBlock" class="color-block"></div>
                            <p class="mt-3 fs-5" id="colorBlockCaption"></p>
                        </div>

                        <!-- æ‰€æœ‰è‰²å· -->
                        <div class="mt-4">
                            <h5 class="text-center mb-3">æ‰€æœ‰å¯ç”¨è‰²å·</h5>
                            <div class="row g-3" id="allColorsGrid">
                                <!-- åŠ¨æ€ç”Ÿæˆæ‰€æœ‰è‰²å· -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- é”™è¯¯æç¤º -->
        <div id="errorArea" class="mt-5" style="display: none;">
            <div class="alert alert-danger">
                <i class="bi bi-exclamation-triangle me-2"></i>
                <span id="errorMsg"></span>
            </div>
            <div class="text-center">
                <button class="btn btn-outline-danger" onclick="resetUpload()">é‡æ–°å°è¯•</button>
            </div>
        </div>

        <!-- ä½¿ç”¨è¯´æ˜ -->
        <div class="row justify-content-center mt-5">
            <div class="col-md-10">
                <div class="card p-4">
                    <h5><i class="bi bi-info-circle me-2"></i>ä½¿ç”¨è¯´æ˜</h5>
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <h6><i class="bi bi-check text-success me-2"></i>ä¸Šä¼ è¦æ±‚</h6>
                                <ul>
                                    <li>æ¸…æ™°çš„äººè„¸æ­£é¢ç…§ç‰‡</li>
                                    <li>å…‰çº¿å‡åŒ€ï¼Œæ— é®æŒ¡</li>
                                    <li>å»ºè®®ä½¿ç”¨è‡ªç„¶å…‰æ‹æ‘„</li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <h6><i class="bi bi-lightning text-warning me-2"></i>åŒ¹é…åŸç†</h6>
                                <ul>
                                    <li>åŸºäºé¢œè‰²ç›¸ä¼¼åº¦ç®—æ³•</li>
                                    <li>è®¡ç®—RGBç©ºé—´æ¬§æ°è·ç¦»</li>
                                    <li>è·ç¦»è¶Šå°åŒ¹é…åº¦è¶Šé«˜</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

      <!-- å…¬å…±åº•éƒ¨ -->
  <footer class="bg-dark text-white py-5 mt-10">
    <div class="container text-center">
      <p>Â© 2026 å¯‡å®¹ç§‘æŠ€æœ‰é™å…¬å¸ ç‰ˆæƒæ‰€æœ‰</p>
      <p class="text-muted small mb-0">ä¸œå—äºšåŸç›¸æœºçœŸå®ç¾å¦†æµ‹è¯„å¹³å°</p>
    </div>
  </footer>


    <script>
        // è‰²å·æ•°æ®åº“ï¼ˆå¯æ ¹æ®å®é™…äº§å“ä¿®æ”¹ï¼‰
        const colorCodes = {
            "è‡ªç„¶è±¡ç‰™ç™½": ["N01 è‡ªç„¶è±¡ç‰™ç™½", [172, 140, 120]],
            "è‡ªç„¶ç±³è‰²": ["N02 è‡ªç„¶ç±³è‰²", [185, 155, 135]],
            "æµ…ç±³è‰²": ["L01 æµ…ç±³è‰²", [198, 170, 152]],
            "ç²‰è°ƒä¸€ç™½": ["P01 ç²‰è°ƒä¸€ç™½", [210, 165, 145]],
            "é»„è°ƒäºŒç™½": ["Y02 é»„è°ƒäºŒç™½", [190, 160, 130]],
            "å¥åº·å°éº¦": ["W01 å°éº¦è‰²", [165, 130, 100]],
            "æš–è°ƒè‡ªç„¶": ["W02 æš–è°ƒè‡ªç„¶", [180, 145, 125]],
            "å†·è°ƒç²‰ç™½": ["C01 å†·è°ƒç²‰ç™½", [205, 170, 150]]
        };

        let uploadedImage = null;

        // åˆå§‹åŒ–æ‰€æœ‰è‰²å·æ˜¾ç¤º
        function initColorGrid() {
            const container = document.getElementById('allColorsGrid');
            container.innerHTML = '';
            
            Object.entries(colorCodes).forEach(([name, [code, rgb]]) => {
                const color = `rgb(${rgb[0]}, ${rgb[1]}, ${rgb[2]})`;
                const col = document.createElement('div');
                col.className = 'col-md-3 col-6';
                col.innerHTML = `
                    <div class="card h-100">
                        <div style="height: 60px; background-color: ${color}; border-radius: 6px 6px 0 0;"></div>
                        <div class="card-body p-3 text-center">
                            <h6 class="card-title mb-1">${name}</h6>
                            <p class="card-text small text-muted mb-1">${code}</p>
                            <p class="card-text small">RGB: ${rgb[0]}, ${rgb[1]}, ${rgb[2]}</p>
                        </div>
                    </div>
                `;
                container.appendChild(col);
            });
        }

        // æ–‡ä»¶ä¸Šä¼ å¤„ç†
        document.getElementById('imageUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!file.type.match('image.*')) {
                showError('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶ï¼ˆJPG/PNGæ ¼å¼ï¼‰');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(event) {
                uploadedImage = event.target.result;
                const previewImg = document.getElementById('previewImg');
                previewImg.src = uploadedImage;
                document.getElementById('imagePreview').style.display = 'block';
                document.getElementById('uploadArea').style.display = 'none';
            };
            reader.readAsDataURL(file);
        });

        // åˆ†æå›¾ç‰‡
        function analyzeImage() {
            if (!uploadedImage) return;
            
            document.getElementById('loadingSpinner').style.display = 'block';
            document.getElementById('imagePreview').style.display = 'none';
            
            // æ¨¡æ‹Ÿè¿›åº¦æ¡
            let progress = 0;
            const progressBar = document.getElementById('progressBar');
            const interval = setInterval(() => {
                progress += 10;
                progressBar.style.width = progress + '%';
                if (progress >= 100) {
                    clearInterval(interval);
                    processImage();
                }
            }, 200);
        }

        // å¤„ç†å›¾ç‰‡
        function processImage() {
            const img = new Image();
            img.onload = function() {
                // åˆ›å»ºCanvas
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                
                // è·å–å›¾ç‰‡æ•°æ®
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                
                // åˆ†æè‚¤è‰²ï¼ˆç®€åŒ–ç‰ˆï¼‰
                let totalR = 0, totalG = 0, totalB = 0;
                let pixelCount = 0;
                
                // å–æ ·ä¸­é—´åŒºåŸŸï¼ˆå‡è®¾äººè„¸åœ¨ä¸­é—´ï¼‰
                const startX = Math.floor(canvas.width * 0.3);
                const startY = Math.floor(canvas.height * 0.3);
                const endX = Math.floor(canvas.width * 0.7);
                const endY = Math.floor(canvas.height * 0.7);
                
                for (let y = startY; y < endY; y += 5) {
                    for (let x = startX; x < endX; x += 5) {
                        const index = (y * canvas.width + x) * 4;
                        const r = data[index];
                        const g = data[index + 1];
                        const b = data[index + 2];
                        
                        // ç®€å•çš„è‚¤è‰²åˆ¤æ–­ï¼ˆRGBèŒƒå›´ï¼‰
                        if (r > 100 && r < 220 && g > 80 && g < 200 && b > 60 && b < 180) {
                            totalR += r;
                            totalG += g;
                            totalB += b;
                            pixelCount++;
                        }
                    }
                }
                
                if (pixelCount === 0) {
                    showError('æœªèƒ½æ£€æµ‹åˆ°æœ‰æ•ˆè‚¤è‰²åŒºåŸŸï¼Œè¯·ä¸Šä¼ æ›´æ¸…æ™°çš„äººè„¸ç…§ç‰‡');
                    document.getElementById('loadingSpinner').style.display = 'none';
                    return;
                }
                
                // è®¡ç®—å¹³å‡è‚¤è‰²
                const avgR = Math.round(totalR / pixelCount);
                const avgG = Math.round(totalG / pixelCount);
                const avgB = Math.round(totalB / pixelCount);
                const skinColor = [avgR, avgG, avgB];
                
                // åŒ¹é…è‰²å·
                const match = findBestMatch(skinColor);
                
                // æ˜¾ç¤ºç»“æœ
                displayResults(skinColor, match);
                document.getElementById('loadingSpinner').style.display = 'none';
            };
            img.src = uploadedImage;
        }

        // æŸ¥æ‰¾æœ€ä½³åŒ¹é…
        function findBestMatch(skinColor) {
            let bestMatch = null;
            let minDistance = Infinity;
            
            for (const [name, [code, color]] of Object.entries(colorCodes)) {
                // è®¡ç®—æ¬§æ°è·ç¦»
                const distance = Math.sqrt(
                    Math.pow(skinColor[0] - color[0], 2) +
                    Math.pow(skinColor[1] - color[1], 2) +
                    Math.pow(skinColor[2] - color[2], 2)
                );
                
                if (distance < minDistance) {
                    minDistance = distance;
                    bestMatch = {
                        name: name,
                        code: code,
                        color: color,
                        distance: Math.round(distance * 100) / 100
                    };
                }
            }
            
            return bestMatch;
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResults(skinColor, match) {
            // è®¾ç½®ç»“æœ
            document.getElementById('colorName').textContent = match.name;
            document.getElementById('colorCode').textContent = match.code;
            document.getElementById('colorRgb').textContent = `(${match.color[0]}, ${match.color[1]}, ${match.color[2]})`;
            document.getElementById('skinRgb').textContent = `(${skinColor[0]}, ${skinColor[1]}, ${skinColor[2]})`;
            document.getElementById('distance').textContent = match.distance;
            
            // è®¾ç½®è‰²å—
            const colorBlock = document.getElementById('colorBlock');
            const color = `rgb(${match.color[0]}, ${match.color[1]}, ${match.color[2]})`;
            colorBlock.style.backgroundColor = color;
            
            // è®¾ç½®æ ‡é¢˜
            document.getElementById('colorBlockCaption').innerHTML = `
                <strong>${match.name}</strong> - ${match.code}<br>
                <small class="text-muted">ç‚¹å‡»è‰²å—å¯æŸ¥çœ‹RGBå€¼</small>
            `;
            
            // æ˜¾ç¤ºç»“æœåŒºåŸŸ
            document.getElementById('resultArea').style.display = 'block';
            
            // åˆå§‹åŒ–æ‰€æœ‰è‰²å·ç½‘æ ¼
            initColorGrid();
        }

        // æ˜¾ç¤ºé”™è¯¯
        function showError(message) {
            document.getElementById('errorMsg').textContent = message;
            document.getElementById('errorArea').style.display = 'block';
        }

        // é‡ç½®ä¸Šä¼ 
        function resetUpload() {
            document.getElementById('imageUpload').value = '';
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('uploadArea').style.display = 'block';
            document.getElementById('resultArea').style.display = 'none';
            document.getElementById('errorArea').style.display = 'none';
            uploadedImage = null;
        }

        // æ‹–æ‹½ä¸Šä¼ 
        const uploadArea = document.getElementById('uploadArea');
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#ff6b6b';
            uploadArea.style.backgroundColor = '#fff5f5';
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = '#ddd';
            uploadArea.style.backgroundColor = 'white';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#ddd';
            uploadArea.style.backgroundColor = 'white';
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type.match('image.*')) {
                document.getElementById('imageUpload').files = files;
                const event = new Event('change');
                document.getElementById('imageUpload').dispatchEvent(event);
            }
        });

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initColorGrid();
        });
    </script>
</body>
</html>